from .forms import CommentForm

def post_detail(request, pk):
    post = get_object_or_404(Post, pk=pk)
    comment_form = CommentForm()
    context = {'post': post, 'comment_form': comment_form}
    return render(request, 'blog/post_detail.html', context)

{% extends "blog/base.html" %}

{% block content %}

<article>
    <h1>{{ post.title }}</h1>
    <p>By {{ post.author }} Â· {{ post.published_at }}</p>

    <div>
        {{ post.content|linebreaksbr }}
    </div>

    {% if user == post.author %}
        <p>
            <a href="{% url 'blog:post-update' post.pk %}">Edit</a> |
            <a href="{% url 'blog:post-delete' post.pk %}">Delete</a>
        </p>
    {% endif %}
</article>

<hr>

{# COMMENTS LIST #}
{% include "blog/_comments.html" %}

<hr>

{# COMMENT FORM #}
{% if user.is_authenticated %}
    <h3>Leave a comment</h3>
    <form method="post" action="{% url 'blog:comment_create' post.pk %}">
        {% csrf_token %}
        {{ comment_form.non_field_errors }}
        <div>
            {{ comment_form.content.errors }}
            {{ comment_form.content }}
        </div>
        <button type="submit">Post comment</button>
    </form>
{% else %}
    <p>
        <a href="{% url 'blog:login' %}?next={{ request.path }}">
            Log in
        </a> to leave a comment.
    </p>
{% endif %}

{% endblock %}

<p>Tags:
    {% for tag in post.tags.all %}
        <a href="{% url 'blog:posts_by_tag' tag.slug %}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
    {% empty %}
        No tags
    {% endfor %}
</p>

